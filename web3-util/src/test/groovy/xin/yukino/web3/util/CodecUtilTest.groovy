package xin.yukino.web3.util


import org.web3j.utils.Numeric
import spock.lang.Specification

class CodecUtilTest extends Specification {

    def "GetRawTransactionData"() {
        given:
        def chain = Chain.ETH_MAIN
        def txHash = "0xeddf9e61fb9d8f5111840daef55e5fde0041f5702856532cdbb5a02998033d26"
        when:
        def data = CodecUtil.getRawTransactionData(txHash, chain)
        then:
        println data
    }

    def "toChecksumAddress"() {
        given:
        def addr = "0x77b92032e7fa6915c2744aef5f8dd59d7ad390f8";
        expect:
        println CodecUtil.toChecksumAddress(addr)
    }

    def "brotliCompress"() {
        given:
        def code = "0x6080604052600436106101e55760003560e01c806305bd783f146101fa578063093049231461021a57806315df1e8e1461023a5780631d7327561461025a5780631fad948c1461028d578063205c2878146102ad5780633e02099e146102cd5780634b1d7cf51461030d5780634bc8555d1461032d578063512b03f41461034d5780635287ce121461037a578063532d3ac91461049857806355f8117c146104b8578063588d0087146104d857806358db98ba146105085780635dc87e9d14610538578063679986761461055857806370a0823114610578578063715018a6146105985780637992cd6f146105ad57806381d067df146105cd57806387b3d8f8146105ed5780638d1e8f121461060e5780638da5cb5b1461062e5780638f41ec5a146106435780639821a0c6146106585780639b249f69146106785780639fcd740e14610698578063a2d1b1d6146106b8578063a2eea325146106d9578063a6193531146106f9578063a81ea03f14610719578063b2da737a14610739578063b74f86ca14610759578063b760faf91461076e578063becf9b2d14610781578063c2077116146107a2578063dc1a0911146107c2578063ee219423146107e2578063f2fde38b14610802578063f569775c14610822578063fc7e286d1461084257600080fd5b366101f5576101f3336108f8565b005b600080fd5b34801561020657600080fd5b506101f3610215366004613af2565b610919565b34801561022657600080fd5b506101f3610235366004613b53565b610a80565b34801561024657600080fd5b506101f3610255366004613b7e565b610af1565b34801561026657600080fd5b5061027a610275366004613d39565b610b51565b6040519081526020015b60405180910390f35b34801561029957600080fd5b506101f36102a8366004613e03565b610c6a565b3480156102b957600080fd5b506101f36102c8366004613e59565b610f1a565b3480156102d957600080fd5b506102fd6102e8366004613b53565b60046020526000908152604090205460ff1681565b6040519015158152602001610284565b34801561031957600080fd5b506101f3610328366004613e03565b611092565b34801561033957600080fd5b506101f3610348366004613e85565b6110d7565b34801561035957600080fd5b5060025461036d906001600160a01b031681565b6040516102849190613ebe565b34801561038657600080fd5b5061043f610395366004613b53565b6040805160a081018252600080825260208201819052918101829052606081018290526080810191909152506001600160a01b031660009081526020818152604091829020825160a08101845281546001600160701b038082168352600160701b820460ff16151594830194909452600160781b90049092169282019290925260019091015463ffffffff81166060830152600160201b90046001600160401b0316608082015290565b6040805182516001600160701b03908116825260208085015115159083015283830151169181019190915260608083015163ffffffff16908201526080918201516001600160401b03169181019190915260a001610284565b3480156104a457600080fd5b506101f36104b3366004613ed2565b61113f565b3480156104c457600080fd5b506101f36104d3366004613af2565b61114a565b3480156104e457600080fd5b506104f86104f3366004613d39565b611167565b6040516102849493929190613f9b565b34801561051457600080fd5b506102fd610523366004613b53565b60036020526000908152604090205460ff1681565b34801561054457600080fd5b5061027a610553366004613fd1565b6112d2565b34801561056457600080fd5b506101f3610573366004613af2565b611356565b34801561058457600080fd5b5061027a610593366004613b53565b61147f565b3480156105a457600080fd5b506101f36114a3565b3480156105b957600080fd5b506101f36105c8366004613b53565b6114b7565b3480156105d957600080fd5b506101f36105e8366004614060565b611551565b3480156105f957600080fd5b506001546102fd90600160a01b900460ff1681565b34801561061a57600080fd5b506101f3610629366004613e85565b611617565b34801561063a57600080fd5b5061036d611677565b34801561064f57600080fd5b5061027a600181565b34801561066457600080fd5b506101f3610673366004614110565b611686565b34801561068457600080fd5b506101f3610693366004614164565b611825565b3480156106a457600080fd5b506101f36106b3366004613b53565b6118bb565b3480156106c457600080fd5b506001546102fd90600160b01b900460ff1681565b3480156106e557600080fd5b506101f36106f4366004613b7e565b611ad2565b34801561070557600080fd5b5061027a610714366004613af2565b611b27565b34801561072557600080fd5b506101f3610734366004613b7e565b611b69565b34801561074557600080fd5b506101f3610754366004613af2565b611bbe565b34801561076557600080fd5b5061027a600281565b6101f361077c366004613b53565b6108f8565b34801561078d57600080fd5b506001546102fd90600160a81b900460ff1681565b3480156107ae57600080fd5b506101f36107bd366004613af2565b611c69565b3480156107ce57600080fd5b506101f36107dd366004614199565b611cfe565b3480156107ee57600080fd5b506101f36107fd366004613af2565b611e47565b34801561080e57600080fd5b506101f361081d366004613b53565b611f99565b34801561082e57600080fd5b506101f361083d366004613af2565b61200f565b34801561084e57600080fd5b506108b161085d366004613b53565b600060208190529081526040902080546001909101546001600160701b0380831692600160701b810460ff1692600160781b9091049091169063ffffffff811690600160201b90046001600160401b031685565b604080516001600160701b0396871681529415156020860152929094169183019190915263ffffffff1660608201526001600160401b03909116608082015260a001610284565b6000516064900a607b81900361090c575050565b61091582612028565b5050565b60006109286020830183613b53565b905036600061093b6101208501856141c7565b909250905061094d60408501856141c7565b159050801561096457506001600160a01b0383163b155b1561098a5760405162461bcd60e51b815260040161098190614239565b60405180910390fd5b601481106109d25760006109a1601482848661424b565b6109aa91614275565b60601c9050803b6000036109d05760405162461bcd60e51b8152600401610981906142d3565b505b6040805160028082526060820183526000926020830190803683370190505090507f1cf5a0fe3bf24282cc81b8ffae2e5e3aa750f3f182a6665e22ba4ab24da3aaf360001b81600081518110610a2a57610a2a6142e5565b602002602001018181525050610a408482611551565b610a5e847381e11c4701c5189b0122ef42daf1ff3d453d968e611cfe565b60405162461bcd60e51b81526020600482015260006024820152604401610981565b6001600160a01b03811660009081526004602052604090205460ff16610aee57600154600160b01b900460ff16610aee5760405162461bcd60e51b81526020600482015260126024820152716e6f7420616c6c6f776564206d6f64756c6560701b6044820152606401610981565b50565b610af96120a9565b60018054821515600160b01b0260ff60b01b199091161790556040517ff068df4a3f0404e2c926c24e28d908a9601d55c68d990676f588550ba604d49d90610b4690831515815260200190565b60405180910390a150565b6000805a9050333014610b765760405162461bcd60e51b8152600401610981906142fb565b600085600001519050600080600083600001516001600160a01b031684604001518c8c604051610ba792919061432c565b60006040518083038160008787f1925050503d8060008114610be5576040519150601f19603f3d011682016040523d82523d6000602084013e610bea565b606091505b509150915081610c0957610c0089828d8d612108565b60019250610c0e565b600092505b610c596000848b8b8b8080601f01602080910402602001604051908101604052809392919081815260200183838082843760009201919091525050505060808e01515a8b030161212b565b955050505050505b95945050505050565b33600090815260036020526040902054829060ff16610d2957600154600160a81b900460ff168015610c9b57503332145b610ce35760405162461bcd60e51b815260206004820152601960248201527831b0b63632b210313c9034b63632b3b0b610313ab7323632b960391b6044820152606401610981565b80600114610d295760405162461bcd60e51b815260206004820152601360248201527206f6e6c7920737570706f7274206f6e65206f7606c1b6044820152606401610981565b6000816001600160401b03811115610d4357610d43613be3565b604051908082528060200260200182016040528015610d7c57816020015b610d69613a4f565b815260200190600190039081610d615790505b5090506000805b83811015610f075730635dc87e9d82898982818110610da457610da46142e5565b9050602002810190610db6919061433c565b868581518110610dc857610dc86142e5565b602002602001015160006040518563ffffffff1660e01b8152600401610df19493929190614540565b6020604051808303816000875af1925050508015610e2c575060408051601f3d908101601f19168201909252610e2991810190614585565b60015b610ef9573d808015610e5a576040519150601f19603f3d011682016040523d82523d6000602084013e610e5f565b606091505b507fd39257af171847db4dcff4dfb218d6e9b61d481e7006509acf163c00bd39d5e1888884818110610e9357610e936142e5565b9050602002810190610ea5919061433c565b610eb3906020810190613b53565b898985818110610ec557610ec56142e5565b9050602002810190610ed7919061433c565b6020013583604051610eeb9392919061459e565b60405180910390a150610eff565b91909101905b600101610d83565b50610f12848261243e565b505050505050565b33600090815260208190526040902080546001600160701b0316821115610f7f5760405162461bcd60e51b8152602060048201526019602482015278576974686472617720616d6f756e7420746f6f206c6172676560381b6044820152606401610981565b8054610f959083906001600160701b03166145db565b81546001600160701b0319166001600160701b0391909116178155604080516001600160a01b03851681526020810184905233917fd1c19fbcd4551a5edfb66d43d2e337c04837afda3482b42bdf569a8fccdae5fb910160405180910390a26000836001600160a01b03168360405160006040518083038185875af1925050503d8060008114611041576040519150601f19603f3d011682016040523d82523d6000602084013e611046565b606091505b505090508061108c5760405162461bcd60e51b81526020600482015260126024820152716661696c656420746f20776974686472617760701b6044820152606401610981565b50505050565b60405162461bcd60e51b815260206004820152601a602482015279139bdd081cdd5c1c1bdc9d081859d9dc9959d85d1bdc881e595d60321b6044820152606401610981565b6110df6120a9565b6001600160a01b038216600081815260046020908152604091829020805460ff191685151590811790915591519182527f79a26efc1363c97f8ce116f47ae0f8b2dcfc66acedb772dd411c2789b8dbb3b291015b60405180910390a25050565b610915828233610c6a565b610a5e61115a6020830183613b53565b61067360608401846141c7565b6000806000606060005a90503330146111925760405162461bcd60e51b8152600401610981906142fb565b875160008a1561126b5760008083600001516001600160a01b031684604001518f8f6040516111c292919061432c565b60006040518083038160008787f1925050503d8060008114611200576040519150601f19603f3d011682016040523d82523d6000602084013e611205565b606091505b50915091505a61121590866145db565b975081611267578051156112625783600001516001600160a01b03168c60200151600080516020614f148339815191528660200151846040516112599291906145ee565b60405180910390a35b600192505b9450505b60008a608001515a85030190506112bd6000838d8d8d8080601f01602080910402602001604051908101604052809392919081815260200183838082843760009201919091525088925061212b915050565b97508195505050505095509550955095915050565b60003330146113205760405162461bcd60e51b815260206004820152601a60248201527963616e206f6e6c792063616c6c2062792068616e646c654f707360301b6044820152606401610981565b60008061132f87878787612532565b509150915061134087868484612649565b61134b8787876126a2565b979650505050505050565b61135e613a4f565b61136782612772565b600080611378600085856001612532565b509150915061138a6000848484612649565b61139343600052565b61139c8461281b565b60006113aa600086866126a2565b90506113b543600052565b608084015160c0860135906000906113ce9083906145db565b9050600060018614806113e15750600185145b6113ec5760006113ef565b60015b905060006001600160a01b03821660011461141757858710611411578561141a565b8661141a565b60005b600554600654604051631ad7196160e11b81526000600482015265ffffffffffff841660248201526001600160a01b0386166044820152606481018890526084810187905260a481019290925260c482015260e4810187905290915061010401610981565b6001600160a01b03166000908152602081905260409020546001600160701b031690565b6114ab6120a9565b6114b5600061283e565b565b6114bf6120a9565b6002546001600160a01b0316156115065760405162461bcd60e51b815260206004820152600b60248201526a185b1c9958591e481cd95d60aa1b6044820152606401610981565b600280546001600160a01b0319166001600160a01b0383161790556040517f4654006216c08dd14147a0571cc9ae9d4c0508c60e2b4a5f621c5ac5c03eb75090610b46908390613ebe565b816001600160a01b03163b600003611567575050565b80516000805b828110156115be576000848281518110611589576115896142e5565b6020026020010151905082806115a8575080866001600160a01b03163f145b92505080806115b690614607565b91505061156d565b508061108c5760405162461bcd60e51b815260206004820152602260248201527f414130312073656e6465722070726f7879206e6f7420696e2077686974656c696044820152611cdd60f21b6064820152608401610981565b61161f6120a9565b6001600160a01b038216600081815260036020908152604091829020805460ff191685151590811790915591519182527fb331c8cb510b8d82383ef5c2f099bc6356cba45a8d01333c3591666d2bf7a6ef9101611133565b6001546001600160a01b031690565b6001600160a01b03831631811561108c576338320d1160e11b6116a98385614620565b6001600160e01b0319160361172257600080806116c9856004818961424b565b8101906116d69190614675565b925092509250866001600160a01b0316836001600160a01b0316141580156116fd57508184105b1561171a5760405162461bcd60e51b815260040161098190614716565b50505061108c565b635ff7d7e360e11b6117348385614620565b6001600160e01b031916148061176357506341d53e4f60e11b6117578385614620565b6001600160e01b031916145b156117dd5760006117b58561177b856004818961424b565b8080601f01602080910402602001604051908101604052809392919081815260200183838082843760009201919091525061289092505050565b9050808210156117d75760405162461bcd60e51b815260040161098190614716565b5061108c565b60405162461bcd60e51b815260206004820181905260248201527f414130332073656e6465722063616c6c64617461206e6f7420616c6c6f7765646044820152606401610981565b604051632b870d1b60e11b81527377b92032e7fa6915c2744aef5f8dd59d7ad390f89063570e1a369061185e908590859060040161474b565b6020604051808303816000875af115801561187d573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906118a1919061476a565b604051633653dc0360e11b81526004016109819190613ebe565b600154600160a01b900460ff16610aee57600254604051635f8b295760e11b81526001600160a01b039091169063bf1652ae906118fc908490600401613ebe565b602060405180830381865afa158015611919573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061193d9190614787565b6119995760405162461bcd60e51b815260206004820152602760248201527f73656e646572206e6f7420637265617465642062792077686974656c69737420604482015266666163746f727960c81b6064820152608401610981565b600260009054906101000a90046001600160a01b03166001600160a01b0316635eb43cb5826001600160a01b031663a619486e6040518163ffffffff1660e01b8152600401602060405180830381865afa1580156119fb573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611a1f919061476a565b6040518263ffffffff1660e01b8152600401611a3b9190613ebe565b602060405180830381865afa158015611a58573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611a7c9190614787565b610aee5760405162461bcd60e51b815260206004820152602160248201527f73656e64657220696d706c656d656e74206e6f7420696e2077686974656c69736044820152601d60fa1b6064820152608401610981565b611ada6120a9565b60018054821515600160a81b0260ff60a81b199091161790556040517f82f6ab2bf95087376b9e75046d21cb646ccf6cb1982a1b5913f6ea19841ba26390610b4690831515815260200190565b6000611b328261294c565b6040805160208101929092523090820152466060820152608001604051602081830303815290604052805190602001209050919050565b611b716120a9565b60018054821515600160a01b0260ff60a01b199091161790556040517f1c5b183adeda292ff2038b567b6a33a832987733f59251afff77fe48c871ce2990610b4690831515815260200190565b611bc6613a4f565b600080611bd7600085856001612532565b5091509150611be96000848484612649565b611bf96106b36020860186613b53565b600080600080611c0b60008989612965565b93509350935093506000611c228860000151612a46565b90508760800151838360008411611c3a576000611c44565b611c4484896147a4565b87858c8c60405163460b0b3560e11b81526004016109819897969594939291906147c6565b611c71613a4f565b600080611c82600085856001612532565b509150915060018203611c9457600091505b60018103611ca0575060005b611cad6000848484612649565b611cb643600052565b6000611cc4600086866126a2565b6080850151604051635187e98f60e11b81526004810191909152602481018290526044810185905260648101849052909150608401610981565b816001600160a01b03163b600003611d14575050565b6000816001600160a01b0316635eb43cb5846001600160a01b031663a619486e6040518163ffffffff1660e01b8152600401602060405180830381865afa158015611d63573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611d87919061476a565b6040518263ffffffff1660e01b8152600401611da39190613ebe565b602060405180830381865afa158015611dc0573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611de49190614787565b905080611e425760405162461bcd60e51b815260206004820152602660248201527f414130322073656e64657220696d706c656d656e74206e6f7420696e207768696044820152651d195b1a5cdd60d21b6064820152608401610981565b505050565b611e4f613a4f565b6000806000611e62600086866001612532565b9250925092506000611e7b856000015160a00151612a78565b855151909150600090611e8d90612a78565b9050366000611e9f60408a018a6141c7565b909250905060006014821015611eb6576000611ed1565b611ec460146000848661424b565b611ecd91614275565b60601c5b90506000611ede82612a78565b905060006040518060a001604052808c6080015181526020018c6040015181526020018b81526020018a8152602001611f188d6060015190565b905290506001600160a01b03881615611f7857600060405180604001604052808a6001600160a01b03168152602001611f508b612a78565b81525090508187848a84604051631945b05b60e31b8152600401610981959493929190614865565b80868389604051633dd956e960e01b815260040161098194939291906148d1565b611fa16120a9565b6001600160a01b0381166120065760405162461bcd60e51b815260206004820152602660248201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160448201526564647265737360d01b6064820152608401610981565b610aee8161283e565b612017613a4f565b600080611bd7600085856000612ac7565b6120328134612be5565b6001600160a01b03811660008181526020818152604091829020805483513381523093810193909352928201939093523460608201526001600160701b0390911660808201527fb045190548dadae679cfe9e337437613ca6dd73efdf984f75e56f152ccee22f09060a00160405180910390a15050565b336120b2611677565b6001600160a01b0316146114b55760405162461bcd60e51b815260206004820181905260248201527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e65726044820152606401610981565b60008190036121225761211d84848484612c81565b61108c565b61108c83612cc8565b6000805a85519091506000908161214182612a46565b60a08301519091506001600160a01b0381166121605782519350612356565b80935060008851111561235657868202955060028a600281111561218657612186613f13565b146122ac57606083015160405163a9a2340960e01b81526001600160a01b0383169163a9a23409916121c0908e908d908c9060040161490d565b600060405180830381600088803b1580156121da57600080fd5b5087f1935050505080156121ec575060015b6122a7576121f861493d565b806308c379a003612252575061220c614959565b806122175750612254565b8b828260405160200161222a91906149e2565b60408051601f198184030181529082905262fa072b60e01b8252610981939291600401614a20565b505b60405162fa072b60e01b8152600481018c90526001600160a01b038216602482015260606044820152601260648201527110504d4c081c1bdcdd13dc081c995d995c9d60721b608482015260a401610981565b612356565b606083015160405163a9a2340960e01b81526001600160a01b0383169163a9a23409916122e1908e908d908c9060040161490d565b600060405180830381600088803b1580156122fb57600080fd5b5087f19350505050801561230d575060015b6123565761231961493d565b806308c379a003612252575061232d614959565b806123385750612254565b8b828260405162fa072b60e01b815260040161098193929190614a20565b60005a8603905061236681600655565b80880197508288029650868a6040015110156123da5760405162fa072b60e01b8152600481018d90526001600160a01b038316602482015260606044820152602060648201527f414135312070726566756e642062656c6f772061637475616c476173436f7374608482015260a401610981565b60408a01518790036001600160a01b0383166123ff576123fa8682612cd0565b612409565b6124098682612be5565b506000808c600281111561241f5761241f613f13565b14905061242e8b828a8c612d89565b5050505050505095945050505050565b6001600160a01b03821661248f5760405162461bcd60e51b81526020600482015260186024820152774141393020696e76616c69642062656e656669636961727960401b6044820152606401610981565b6000826001600160a01b03168260405160006040518083038185875af1925050503d80600081146124dc576040519150601f19603f3d011682016040523d82523d6000602084013e6124e1565b606091505b5050905080611e425760405162461bcd60e51b815260206004820152601f60248201527f41413931206661696c65642073656e6420746f2062656e6566696369617279006044820152606401610981565b6000806000805a86519091506125488882612e0b565b61255188611b27565b6020880152604081015160608201516080830151171760e089013517610100890135176001600160781b0381111561259b5760405162461bcd60e51b815260040161098190614a4a565b6000806125a784612f04565b90506125b68c8c8c8c85612f52565b9950965091506125c543600052565b60a08401516060906001600160a01b0316156125ed576125e88d8d8d8587613292565b985090505b5a86038c60a00135101561261a5760a085015160405162fa072b60e01b8152610981918f91600401614a7c565b60408b018290528060608c015260c08c01355a8703018b60800181815250505050505050509450945094915050565b4282101561108c576002820361108c5760405162fa072b60e01b8152600481018590526000602482015260606044820152601060648201526f20a0991a903737b731b29032b93937b960811b608482015260a401610981565b6000805a905060006126b5846060015190565b905030631d7327566126ca60608801886141c7565b87856040518563ffffffff1660e01b81526004016126eb9493929190614ac8565b6020604051808303816000875af1925050508015612726575060408051601f3d908101601f1916820190925261272391810190614585565b60015b61276657612732613431565b600084608001515a61274490856145db565b61274e9190614aff565b905061275e87600287858561212b565b935050612769565b92505b50509392505050565b6040516305bd783f60e01b815230906305bd783f90612795908490600401614b12565b60006040518083038186803b1580156127ad57600080fd5b505afa9250505080156127be575060015b610aee576127ca61493d565b806308c379a00361280f57506127de614959565b806127e95750612811565b805115610915576000808260405162fa072b60e01b815260040161098193929190614a20565b505b3d6000803e3d6000fd5b60405163157e045f60e21b815230906355f8117c90612795908490600401614b12565b600180546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b600080828060200190518101906128a79190614b74565b8051909150600090815b8181101561293f5760008482815181106128cd576128cd6142e5565b60200260200101519050876001600160a01b031681602001516001600160a01b0316146129065760408101516129039085614aff565b93505b6080810151511561292c5761291f888260800151612890565b6129299085614aff565b93505b508061293781614607565b9150506128b1565b5090925050505b92915050565b600061295782613449565b805190602001209050919050565b6000806000606060005a9050600061297e876060015190565b90503063588d008761299360608b018b6141c7565b8a856040518563ffffffff1660e01b81526004016129b49493929190614ac8565b6000604051808303816000875af19250505080156129f457506040513d6000823e601f3d908101601f191682016040526129f19190810190614cbb565b60015b612a3057600087608001515a612a0a90856145db565b612a149190614aff565b9050612a248a60028a858561212b565b96506002945050612a3b565b929850909650945092505b505093509350935093565b60008160e001518260c0015114612a7057612a6b8260c00151488460e001510161351c565b612946565b5060c0015190565b604080518082018252600080825260208083018281526001600160a01b03959095168252819052919091208054600160781b90046001600160701b031682526001015463ffffffff1690915290565b6000806000805a8651909150612add8882612e0b565b612ae688611b27565b6020880152604081015160608201516080830151171760e089013517610100890135176001600160781b03811115612b305760405162461bcd60e51b815260040161098190614a4a565b600080612b3c84612f04565b9050612b4b8c8c8c8c85613534565b995096509150612b5a43600052565b60a08401516060906001600160a01b031615612b8257612b7d8d8d8d85876135ce565b985090505b60005a87039050808d60a001351015612bb5578d8660a0015160405162fa072b60e01b8152600401610981929190614a7c565b60408c018390528160608d015260c08d01355a8803018c6080018181525050505050505050509450945094915050565b6001600160a01b03821660009081526020819052604081208054909190612c169084906001600160701b0316614aff565b90506001600160701b03811115612c625760405162461bcd60e51b815260206004820152601060248201526f6465706f736974206f766572666c6f7760801b6044820152606401610981565b81546001600160701b0319166001600160701b03919091161790555050565b83518051602080870151908301516040516001600160a01b0390931692600080516020614f1483398151915291612cb99189906145ee565b60405180910390a35050505050565b805160208201fd5b6000826001600160a01b03168261119490604051600060405180830381858888f193505050503d8060008114612d22576040519150601f19603f3d011682016040523d82523d6000602084013e612d27565b606091505b505090508015612d7f57604080513381526001600160a01b03851660208201529081018390527fddb7670d8b3456e257dddc6e3467732d51690ef7725ecabba73f15b72cecabfd9060600160405180910390a1505050565b611e428383612be5565b6005819055835160a08101518151602080880151908401516040516001600160a01b039485169493909316927f49628fd1471006c1482da88028e9ce4dbb080b815c9b0344d39e5a8e6ec1419f91612dfc918a908a908a9093845291151560208401526040830152606082015260800190565b60405180910390a45050505050565b612e186020830183613b53565b6001600160a01b0316815260208083013590820152608080830135604083015260a0830135606083015260c0808401359183019190915260e0808401359183019190915261010083013590820152366000612e776101208501856141c7565b90925090508015612ef7576014811015612ed35760405162461bcd60e51b815260206004820152601d60248201527f4141393320696e76616c6964207061796d6173746572416e64446174610000006044820152606401610981565b612ee160146000838561424b565b612eea91614275565b60601c60a084015261108c565b600060a084015250505050565b60a081015160009081906001600160a01b0316612f22576001612f25565b60035b60ff1690506000836080015182856060015102856040015101019050612f4a84612a46565b029392505050565b6000806000805a8751805191925090612f788b8a612f7360408e018e6141c7565b613754565b6000196001600160a01b0389160161307c57612f9343600052565b806001600160a01b03163b600003612fc25760008060405162fa072b60e01b8152600401610981929190614d22565b60a08201516001600160a01b031615801590612fea575060a08201516001600160a01b03163b155b1561300c5760008060405162fa072b60e01b8152600401610981929190614d4b565b806001600160a01b0316633ad59dbc6040518163ffffffff1660e01b8152600401602060405180830381865afa925050508015613066575060408051601f3d908101601f191682019092526130639181019061476a565b60015b613076576000945084975061307c565b97508794505b60a08201516000906001600160a01b0381166130b557600061309d8461147f565b90508981116130ae57808a036130b1565b60005b9250505b826001600160a01b0316636b34af6285606001518e8e602001518e876040518663ffffffff1660e01b81526004016130f09493929190614d74565b60206040518083038160008887f19350505050801561312c575060408051601f3d908101601f1916820190925261312991810190614585565b60015b6131c75761313861493d565b806308c379a003613176575061314c614959565b806131575750613178565b8d60008260405162fa072b60e01b815260040161098193929190614a20565b505b60405162fa072b60e01b8152600481018e9052600060248201526060604482015260166064820152754141323320726576657274656420286f72204f4f472960501b608482015260a401610981565b95506001600160a01b03811661327d576001600160a01b038316600090815260208190526040902080546001600160701b0316808b1115613260578e600060405162fa072b60e01b81526004016109819291909182526001600160a01b031660208201526060604082018190526017908201527610504c8c48191a591b89dd081c185e481c1c99599d5b99604a1b608082015260a00190565b81546001600160701b031916908b90036001600160701b03161790555b5a850397505050505050955095509592505050565b825160a0810151606082810151909260009290918581116132c957898260405162fa072b60e01b8152600401610981929190614ddc565b6001600160a01b0382166000908152602081905260409020805487830391906001600160701b031689811015613315578c8560405162fa072b60e01b8152600401610981929190614e05565b8981038260000160006101000a8154816001600160701b0302191690836001600160701b03160217905550846001600160a01b031663f465c77e848e8e602001518e6040518563ffffffff1660e01b815260040161337593929190614e51565b60006040518083038160008887f1935050505080156133b657506040513d6000823e601f3d908101601f191682016040526133b39190810190614e76565b60015b61341d576133c261493d565b806308c379a0036133ff57506133d6614959565b806133e15750613401565b8d868260405162fa072b60e01b815260040161098193929190614a20565b505b8c8560405162fa072b60e01b8152600401610981929190614ebc565b909e909d509b505050505050505050505050565b600061343e610400613a10565b9050610aee81612cc8565b606081356020830135600061346961346460408701876141c7565b613a3c565b9050600061347d61346460608801886141c7565b9050608086013560a087013560c088013560e08901356101008a013560006134ac6134646101208e018e6141c7565b604080516001600160a01b039c909c1660208d01528b81019a909a5260608b019890985250608089019590955260a088019390935260c087019190915260e08601526101008501526101208401526101408084019190915281518084039091018152610160909201905292915050565b600081831061352b578161352d565b825b9392505050565b6000806000805a87518051919250906135558b8a612f7360408e018e6141c7565b806001600160a01b03163b6000036135845760008060405162fa072b60e01b8152600401610981929190614d22565b60a08201516001600160a01b0316158015906135ac575060a08201516001600160a01b03163b155b1561307c5760008060405162fa072b60e01b8152600401610981929190614d4b565b825160608181015190916000918481116135fa5760405162461bcd60e51b815260040161098190614f01565b60a08201516001600160a01b038116600090815260208190526040902080548784039291906001600160701b03168981101561364c578c8360405162fa072b60e01b8152600401610981929190614e05565b8981038260000160006101000a8154816001600160701b0302191690836001600160701b03160217905550826001600160a01b031663682fb5a2858e8e602001518e6040518563ffffffff1660e01b81526004016136ac93929190614e51565b60006040518083038160008887f1935050505080156136ed57506040513d6000823e601f3d908101601f191682016040526136ea9190810190614e76565b60015b61341d576136f961493d565b806308c379a003613736575061370d614959565b806137185750613738565b8d848260405162fa072b60e01b815260040161098193929190614a20565b505b8c8360405162fa072b60e01b8152600401610981929190614ebc565b801561108c578251516001600160a01b0381163b156137c35760405162fa072b60e01b8152600481018690526000602482015260606044820152601f60648201527f414131302073656e64657220616c726561647920636f6e737472756374656400608482015260a401610981565b835160600151604051632b870d1b60e11b81526000917377b92032e7fa6915c2744aef5f8dd59d7ad390f89163570e1a369190613806908890889060040161474b565b60206040518083038160008887f1158015613825573d6000803e3d6000fd5b50505050506040513d601f19601f8201168201806040525081019061384a919061476a565b90506001600160a01b0381166138ae5760405162fa072b60e01b8152600481018790526000602482015260606044820152601b60648201527a4141313320696e6974436f6465206661696c6564206f72204f4f4760281b608482015260a401610981565b816001600160a01b0316816001600160a01b03161461391d5760405162fa072b60e01b8152600481018790526000602482015260606044820152602060648201527f4141313420696e6974436f6465206d7573742072657475726e2073656e646572608482015260a401610981565b806001600160a01b03163b6000036139855760405162fa072b60e01b8152600481018790526000602482015260606044820152602060648201527f4141313520696e6974436f6465206d757374206372656174652073656e646572608482015260a401610981565b6000613994601482868861424b565b61399d91614275565b60601c9050826001600160a01b031686602001517fd51a9c61267aa6196961883ecf5ff2da6619c37dac0fa92122513fb32c032d2d83896000015160a001516040516139ff9291906001600160a01b0392831681529116602082015260400190565b60405180910390a350505050505050565b60603d82811115613a1e5750815b604051602082018101604052818152816000602083013e9392505050565b6000604051828085833790209392505050565b6040518060a00160405280613ab460405180610100016040528060006001600160a01b031681526020016000815260200160008152602001600081526020016000815260200160006001600160a01b0316815260200160008152602001600081525090565b8152602001600080191681526020016000815260200160008152602001600081525090565b60006101608284031215613aec57600080fd5b50919050565b600060208284031215613b0457600080fd5b81356001600160401b03811115613b1a57600080fd5b613b2684828501613ad9565b949350505050565b6001600160a01b0381168114610aee57600080fd5b8035613b4e81613b2e565b919050565b600060208284031215613b6557600080fd5b813561352d81613b2e565b8015158114610aee57600080fd5b600060208284031215613b9057600080fd5b813561352d81613b70565b60008083601f840112613bad57600080fd5b5081356001600160401b03811115613bc457600080fd5b602083019150836020828501011115613bdc57600080fd5b9250929050565b634e487b7160e01b600052604160045260246000fd5b60a081016001600160401b0381118282101715613c1857613c18613be3565b60405250565b61010081016001600160401b0381118282101715613c1857613c18613be3565b601f8201601f191681016001600160401b0381118282101715613c6357613c63613be3565b6040525050565b6000818303610180811215613c7e57600080fd5b604051613c8a81613bf9565b80925061010080831215613c9d57600080fd5b6040519250613cab83613c1e565b613cb485613b43565b835260208501356020840152604085013560408401526060850135606084015260808501356080840152613cea60a08601613b43565b60a084015260c085013560c084015260e085013560e084015282825280850135602083015250610120840135604082015261014084013560608201526101608401356080820152505092915050565b60008060008060006101c08688031215613d5257600080fd5b85356001600160401b0380821115613d6957600080fd5b613d7589838a01613b9b565b9097509550859150613d8a8960208a01613c6a565b94506101a0880135915080821115613da157600080fd5b50613dae88828901613b9b565b969995985093965092949392505050565b60008083601f840112613dd157600080fd5b5081356001600160401b03811115613de857600080fd5b6020830191508360208260051b8501011115613bdc57600080fd5b600080600060408486031215613e1857600080fd5b83356001600160401b03811115613e2e57600080fd5b613e3a86828701613dbf565b9094509250506020840135613e4e81613b2e565b809150509250925092565b60008060408385031215613e6c57600080fd5b8235613e7781613b2e565b946020939093013593505050565b60008060408385031215613e9857600080fd5b8235613ea381613b2e565b91506020830135613eb381613b70565b809150509250929050565b6001600160a01b0391909116815260200190565b60008060208385031215613ee557600080fd5b82356001600160401b03811115613efb57600080fd5b613f0785828601613dbf565b90969095509350505050565b634e487b7160e01b600052602160045260246000fd5b60038110613f4757634e487b7160e01b600052602160045260246000fd5b9052565b60005b83811015613f66578181015183820152602001613f4e565b50506000910152565b60008151808452613f87816020860160208601613f4b565b601f01601f19169290920160200192915050565b848152836020820152613fb16040820184613f29565b608060608201526000613fc76080830184613f6f565b9695505050505050565b6000806000806101e08587031215613fe857600080fd5b8435935060208501356001600160401b0381111561400557600080fd5b61401187828801613ad9565b9350506140218660408701613c6a565b91506101c085013561403281613b2e565b939692955090935050565b60006001600160401b0382111561405657614056613be3565b5060051b60200190565b6000806040838503121561407357600080fd5b823561407e81613b2e565b91506020838101356001600160401b0381111561409a57600080fd5b8401601f810186136140ab57600080fd5b80356140b68161403d565b6040516140c38282613c3e565b82815260059290921b83018401918481019150888311156140e357600080fd5b928401925b82841015614101578335825292840192908401906140e8565b80955050505050509250929050565b60008060006040848603121561412557600080fd5b833561413081613b2e565b925060208401356001600160401b0381111561414b57600080fd5b61415786828701613b9b565b9497909650939450505050565b6000806020838503121561417757600080fd5b82356001600160401b0381111561418d57600080fd5b613f0785828601613b9b565b600080604083850312156141ac57600080fd5b82356141b781613b2e565b91506020830135613eb381613b2e565b6000808335601e198436030181126141de57600080fd5b8301803591506001600160401b038211156141f857600080fd5b602001915036819003821315613bdc57600080fd5b601981527810504c8c081858d8dbdd5b9d081b9bdd0819195c1b1bde5959603a1b602082015260400190565b6020815260006129466020830161420d565b6000808585111561425b57600080fd5b8386111561426857600080fd5b5050820193919092039150565b6001600160601b0319813581811691601485101561429d5780818660140360031b1b83161692505b505092915050565b601b81527a10504ccc081c185e5b585cdd195c881b9bdd0819195c1b1bde5959602a1b602082015260400190565b602081526000612946602083016142a5565b634e487b7160e01b600052603260045260246000fd5b6020808252601790820152764141393220696e7465726e616c2063616c6c206f6e6c7960481b604082015260600190565b8183823760009101908152919050565b6000823561015e1983360301811261435357600080fd5b9190910192915050565b6000808335601e1984360301811261437457600080fd5b83016020810192503590506001600160401b0381111561439357600080fd5b803603821315613bdc57600080fd5b81835281816020850137506000828201602090810191909152601f909101601f19169091010190565b60006101606143ea846143dd85613b43565b6001600160a01b03169052565b60208301356020850152614401604084018461435d565b82604087015261441483870182846143a2565b92505050614425606084018461435d565b85830360608701526144388382846143a2565b925050506080830135608085015260a083013560a085015260c083013560c085015260e083013560e085015261010080840135818601525061012061447f8185018561435d565b868403838801526144918482846143a2565b93505050506101406144a58185018561435d565b8684038388015261134b8482846143a2565b805160018060a01b03808251168452602082015160208501526040820151604085015260608201516060850152608082015160808501528060a08301511660a08501525060c081015160c084015260e081015160e08401525060208101516101008301526040810151610120830152606081015161014083015260808101516101608301525050565b60006101e086835280602084015261455a818401876143cb565b91505061456a60408301856144b7565b6001600160a01b03929092166101c091909101529392505050565b60006020828403121561459757600080fd5b5051919050565b60018060a01b0384168152826020820152606060408201526000610c616060830184613f6f565b634e487b7160e01b600052601160045260246000fd5b81810381811115612946576129466145c5565b828152604060208201526000613b266040830184613f6f565b600060018201614619576146196145c5565b5060010190565b6001600160e01b0319813581811691600485101561429d5760049490940360031b84901b1690921692915050565b60006001600160401b0382111561466757614667613be3565b50601f01601f191660200190565b60008060006060848603121561468a57600080fd5b833561469581613b2e565b92506020840135915060408401356001600160401b038111156146b757600080fd5b8401601f810186136146c857600080fd5b80356146d38161464e565b6040516146e08282613c3e565b8281528860208486010111156146f557600080fd5b82602085016020830137600060208483010152809450505050509250925092565b6020808252818101527f414130342073656e6465722062616c616e636520696e73756666696369656e74604082015260600190565b602081526000613b266020830184866143a2565b8051613b4e81613b2e565b60006020828403121561477c57600080fd5b815161352d81613b2e565b60006020828403121561479957600080fd5b815161352d81613b70565b6000826147c157634e487b7160e01b600052601260045260246000fd5b500490565b60006101008a83526147db602084018b613f29565b8060408401526147ed8184018a613f6f565b60608401989098525050608081019490945260a084019290925260c083015260e0909101529392505050565b805182526020810151602083015260408101516040830152606081015160608301526000608082015160a06080850152613b2660a0850182613f6f565b80518252602090810151910152565b600061014080835261487981840189614819565b9150506148896020830187614856565b6148966060830186614856565b6148a360a0830185614856565b82516001600160a01b031660e083015260208301516148c6610100840182614856565b509695505050505050565b60e0815260006148e460e0830187614819565b90506148f36020830186614856565b6149006060830185614856565b610c6160a0830184614856565b6149178185613f29565b60606020820152600061492d6060830185613f6f565b9050826040830152949350505050565b600060033d11156149565760046000803e5060005160e01c5b90565b600060443d10156149675790565b6040516003193d81016004833e81513d6001600160401b03808311602484018310171561499657505050505090565b82850191508151818111156149ae5750505050505090565b843d87010160208285010111156149c85750505050505090565b6149d760208286010187613c3e565b509095945050505050565b75020a09a98103837b9ba27b8103932bb32b93a32b21d160551b815260008251614a13816016850160208701613f4b565b9190910160160192915050565b8381526001600160a01b0383166020820152606060408201819052600090610c6190830184613f6f565b60208082526018908201527741413934206761732076616c756573206f766572666c6f7760401b604082015260600190565b9182526001600160a01b03166020820152606060408201819052601e908201527f41413430206f76657220766572696669636174696f6e4761734c696d69740000608082015260a00190565b60006101c0808352614add81840187896143a2565b9050614aec60208401866144b7565b8281036101a084015261134b8185613f6f565b80820180821115612946576129466145c5565b60208152600061352d60208301846143cb565b600082601f830112614b3657600080fd5b8151614b418161464e565b604051614b4e8282613c3e565b828152856020848701011115614b6357600080fd5b610c61836020830160208801613f4b565b60006020808385031215614b8757600080fd5b82516001600160401b0380821115614b9e57600080fd5b818501915085601f830112614bb257600080fd5b8151614bbd8161403d565b60408051614bcb8382613c3e565b83815260059390931b8501860192868101925089841115614beb57600080fd5b8686015b84811015614cad57805186811115614c0657600080fd5b870160a0818d03601f19011215614c1c57600080fd5b8351614c2781613bf9565b89820151614c3481613b70565b8152614c4182860161475f565b8a82015260608201518582015260808083015189811115614c625760008081fd5b614c708f8d83870101614b25565b60608401525060a083015189811115614c895760008081fd5b614c978f8d83870101614b25565b9183019190915250855250928701928701614bef565b509998505050505050505050565b60008060008060808587031215614cd157600080fd5b8451935060208501519250604085015160038110614cee57600080fd5b60608601519092506001600160401b03811115614d0a57600080fd5b614d1687828801614b25565b91505092959194509250565b8281526001600160a01b0382166020820152606060408201819052600090613b2690830161420d565b8281526001600160a01b0382166020820152606060408201819052600090613b269083016142a5565b608081526000614d8760808301876143cb565b6020830195909552506001600160a01b03929092166040830152606090910152919050565b601f81527f4141343120746f6f206c6974746c6520766572696669636174696f6e47617300602082015260400190565b8281526001600160a01b0382166020820152606060408201819052600090613b26908301614dac565b9182526001600160a01b03166020820152606060408201819052601e908201527f41413331207061796d6173746572206465706f73697420746f6f206c6f770000608082015260a00190565b606081526000614e6460608301866143cb565b60208301949094525060400152919050565b60008060408385031215614e8957600080fd5b82516001600160401b03811115614e9f57600080fd5b614eab85828601614b25565b925050602083015190509250929050565b9182526001600160a01b03166020820152606060408201819052601690820152754141333320726576657274656420286f72204f4f472960501b608082015260a00190565b60208152600061294660208301614dac56fe1c4fada7374c0a9ee8841fc38afe82932dc0f8e69012e927f061a8bae611a201a264697066735822122067c27ee14b1de3886a1550519af4e8c32113dd2fb5c1daf5c1735a0f2e640fb864736f6c63430008110033"
        expect:
        println Numeric.toHexString(CodecUtil.brotliCompress(Numeric.hexStringToByteArray(code), 11, 24))
    }

    def "decodeFunctionOrError"() {
        given:
        def sig = "handleOps((address,uint256,bytes,bytes,uint256,uint256,uint256,uint256,uint256,bytes,bytes)[], address)";
        def input = "0x1fad948c00000000000000000000000000000000000000000000000000000000000000400000000000000000000000007da47793840ea85b5954edd71b5b51e0959be32c00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000b6486149945ba60b4aff4ddeedd73914695b9656000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000280000000000000000000000000000000000000000000000000000000000000010600000000000000000000000000000000000000000000000000000000000726b1000000000000000000000000000000000000000000000000000000000000cbea000000000000000000000000000000000000000000000000000000062b85e900000000000000000000000000000000000000000000000000000000062b85e90000000000000000000000000000000000000000000000000000000000000002a0000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000000f822ff1dc5998258faa1ea45a776b57484f8ab80a2296601cd000000000000000000000000ac78f1101883a68babcfbaccccaadc7d55e657ba000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000004d20000000000000000000000000000000000000000000000000000000000000060000000000000000000000000a31325ced7e5d13a99ec8a59fdaeb4fc385d049a00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000075f44f59e49ddc8c6f7a7da1e1ec2a5b9d50536e5b0000000000000000656757960000000000000000000000000000000000000000889ffcdff6f6b52d38f3332d87dff86ebc758b6c41e91fd8c11c54fb53085fd44243cb4d56a44f5732e52d77999676305697574447f92a3ddde7b88c73f973961b000000000000000000000000000000000000000000000000000000000000000000000000000000000000620000000000000000000000000000000000000000000000000000000000656751bae2cc3fc0827a755a03461326100f65ac1863669086d90b0514c471c012719a3166eac9944dd997486a1b1792dd1f402c343114f086978b2a141d8ca53ce72c691c000000000000000000000000000000000000000000000000000000000000"
        when:
        def tuple = CodecUtil.decodeFunctionOrError(input, sig)
        then:
        PrintUtil.print(tuple)
    }

    def "decodeStruct"() {
        given:
        def struct = "((bool,address,uint256,bytes,bytes)[])";
        def input = "0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000372653d8929b9281ce2a4e2801a6f6f98e7b4b8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
        when:
        def tuple = CodecUtil.decodeStruct(input, struct)
        then:
        PrintUtil.print(tuple)
    }

    def "buildMethodId"() {
        given:
        def name = "UopReverted(uint256,bytes)";
        when:
        def sig = CodecUtil.buildMethodId(name)
        then:
        println sig
    }

    def "abiEncode"() {
        given:
        def address = "0x5ff137d4b0fdcd49dca30c7cf57e578a026d2789"
        def index = BigInteger.ZERO
        when:
        def slot = CodecUtil.getAddressMapSlot(address, index);
        then:
        println slot
    }
}
